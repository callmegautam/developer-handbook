## 3. Maps and WeakMaps

### Key–Value Structure

A **Map** is a collection of key–value pairs where **keys can be of any type** — including objects, functions, or primitives.

```js
const map = new Map();
map.set("name", "Gautam");
map.set(42, "Answer");
map.set({ key: "obj" }, "Object key");

console.log(map.get("name")); // Gautam
console.log(map.has(42));     // true
console.log(map.size);        // 3
```

Useful methods:

- `.set(key, value)` – add or update entry
    
- `.get(key)` – retrieve value
    
- `.has(key)` – check if key exists
    
- `.delete(key)` – remove entry
    
- `.clear()` – remove all entries
    
- `.size` – number of entries
    

Maps are **iterable** and preserve **insertion order**:

```js
for (const [key, value] of map) {
  console.log(key, value);
}
```

You can convert between Maps and arrays:

```js
const arr = [...map]; // array of [key, value] pairs
const m = new Map(arr); // restore map
```

---

### Differences from Objects

|Feature|**Object**|**Map**|
|---|---|---|
|Key types|Strings & Symbols only|Any value (object, function, primitive)|
|Order|Keys unordered|Keys maintain insertion order|
|Size|Manual (`Object.keys(obj).length`)|`.size` property|
|Iteration|`for...in` or `Object.keys()`|Directly iterable|
|Performance|Optimized for static keys|Optimized for frequent additions/deletions|

Example:

```js
const obj = {};
const key = { id: 1 };
obj[key] = "value"; // "[object Object]" as key (stringified)
console.log(obj); // { '[object Object]': 'value' }

const map = new Map();
map.set(key, "value");
console.log(map.get(key)); // "value" (kept as real object reference)
```

Use **Map** when:

- You need non-string keys.
    
- You frequently add/remove key-value pairs.
    
- You care about iteration order.
    

---

### WeakMap for Private Data

A **WeakMap** is similar to a Map but only allows **object keys** and holds **weak references**, meaning keys don’t prevent garbage collection.

```js
const weakMap = new WeakMap();
let obj = { name: "Gautam" };
weakMap.set(obj, "private data");

console.log(weakMap.get(obj)); // private data
obj = null; // object is garbage collected automatically
```

Key characteristics:

- Keys must be **objects** (not primitives).
    
- **Not iterable** — no `.keys()`, `.values()`, or `.size`.
    
- Prevents memory leaks by letting unused objects be cleaned up.
    

Use cases:

1. **Private Data in Objects**
    
    ```js
    const _private = new WeakMap();
    class User {
      constructor(name) {
        _private.set(this, { name });
      }
      getName() {
        return _private.get(this).name;
      }
    }
    
    const u = new User("Gautam");
    console.log(u.getName()); // Gautam
    // When `u` is garbage collected, its private data is too.
    ```
    
2. **Caching**
    
    ```js
    const cache = new WeakMap();
    function getData(obj) {
      if (!cache.has(obj)) {
        cache.set(obj, expensiveComputation(obj));
      }
      return cache.get(obj);
    }
    ```
    
    This ensures cached data disappears when the original object does, keeping memory usage efficient.